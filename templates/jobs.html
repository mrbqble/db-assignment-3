{% extends 'base.html' %}
{% block content %}
  <h2>Job Postings</h2>
  {% if session.get('user_role') == 'member' %}
  <form method="post" class="form">
    <label>Member ID<select name="member_id">
      {% for m in members %}
        <option value="{{ m.member_user_id }}">{{ m.user.given_name }} {{ m.user.surname }} (id={{ m.member_user_id }})</option>
      {% endfor %}
    </select></label>
    <label>Required type<input name="required_type" placeholder="E.g. Babysitter"></label>
    <label>Other requirements<textarea name="other_requirements"></textarea></label>
    <div class="form-actions"><button class="btn" type="submit">Post Job</button></div>
  </form>
  {% else %}
    <p>Only members may post job advertisements. <a class="btn" href="/login">Log in</a> as a member to post.</p>
  {% endif %}

  <h3>Existing Jobs</h3>
  <ul class="list">
    {% for j in jobs %}
      <li>
        <strong>Job {{ j.job_id }}</strong> - {{ j.required_caregiving_type }} - posted by member {{ j.member_user_id }}<br>
        {{ j.other_requirements }}
        <div style="margin-top:8px">
          {% if session.get('user_role') == 'caregiver' and session.get('user_id') %}
            <form method="post" action="/jobs/apply/{{ j.job_id }}" style="display:inline-block">
              <button class="btn small" type="submit">Apply</button>
            </form>
          {% else %}
            <form method="post" action="/jobs/apply/{{ j.job_id }}" style="display:inline-block">
              <label style="display:inline-block;margin-right:8px">Caregiver ID<input name="caregiver_id" style="width:100px;display:inline-block;margin-left:6px"></label>
              <button class="btn small" type="submit">Apply</button>
            </form>
          {% endif %}
          <a class="btn small outline" href="/jobs/{{ j.job_id }}/applicants">View Applicants</a>
        </div>
      </li>
    {% else %}
      <li>No jobs yet.</li>
    {% endfor %}
  </ul>
{% endblock %}